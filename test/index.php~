<?php
$connection = new mysqli('localhost', 'root', '', 'test'); // устанавливаем соединение с БД
if (mysqli_connect_errno()) {
    printf("Ошибка подключения к базе данных: %s\n", mysqli_connect_error());
    exit();
}
	final class init {
	private function create() {
	global $connection;
	$connection->query( "CREATE TABLE `test` (
  `id` int NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `script_name` text(25) COLLATE 'utf8_unicode_ci' NOT NULL,
  `start_time` time NOT NULL,
  `end_time` time NOT NULL,
  `result` text COLLATE 'utf8_unicode_ci' NOT NULL
) COLLATE 'utf8_unicode_ci';"); //создать таблицу
	}
	private function fill() {
	global $connection;
        $result = array ('normal', 'illegal', 'failed', 'success');
	for ($k=1; $k<11; $k++){
        $x=mt_rand(0, 3);
	$connection->query("INSERT INTO `test` (`script_name`, `start_time`, `end_time`, `result`) VALUES (ROUND((RAND() * (1000 - 0)) + 0), ROUND((RAND() * (1000 - 0)) + 0), ROUND((RAND() * (1000 - 0)) + 0), '');");  // записать 
        $connection->query("UPDATE `test` SET `result`='$result[$x]' where `id`='$k';");
		}
	}
		function __construct() {
			$this->create();
			$this->fill();
		}
	public function get(){
	global $connection;
	$result = $connection->query("select * from test where result='normal' or result='success';");
echo "<table>";
	while($row = $result->fetch_object()){
echo "<tr><td>".$row->id."</td><td>".$row->script_name."</td><td>".$row->start_time."</td><td>".$row->end_time."</td><td>".$row->result."</td></tr>";
}
echo "</table>";
}
	}
	$test = new init;
        $test->get();
?>
<?php
if ($handle = opendir('./datafiles/')) {
    echo "Дескриптор каталога: $handle<br>";
    echo "Файлы:<br>";

    /* Именно этот способ чтения элементов каталога является правильным. */
    while (false !== ($file = readdir($handle))) { 
	if ($file != "." && $file != ".." &&  preg_match("/\.(:?ixt)$/i", $file, $matches) && ! preg_match("/[^a-z0-9\.]+/", $file, $matches)) {
        echo "$file<br>";
	}
    }
closedir($handle); 
}
?>
<?php
$homepage = file_get_contents('http://www.bills.ru/');
//print $homepage;
//$connection->set_charset("windows-1251");
$connection->query( "CREATE TABLE `bills_ru_events` (
  `id` int NOT NULL AUTO_INCREMENT PRIMARY KEY,
  `date` datetime  NOT NULL,
  `title` char(230) COLLATE 'utf8' NOT NULL,
  `url` char(240) COLLATE 'utf8_unicode_ci' NOT NULL UNIQUE)
 ENGINE=MyISAM DEFAULT COLLATE 'utf8_unicode_ci';"); //создать таблицу
$doc = new DOMDocument();
$doc->preserveWhiteSpace = FALSE;
//$doc->encoding = "windows-1251";
$doc->loadHTMLFile('http://www.bills.ru/');
$tags = $doc->getElementById('bizon_api_news_list')->getElementsByTagName('a');
echo "<table>";
foreach ($tags as $tag) {
       echo "<tr><td>".$url=$tag->getAttribute('href')."</td><td> | ".$title=iconv ( 'windows-1251' , 'utf8' ,$tag->nodeValue)."</td></tr>";
$connection->query("INSERT INTO `bills_ru_events` (`title`, `url`) VALUES ('$title', '$url');");
}
echo "</table>";
echo $doc->saveHTML();
?>
